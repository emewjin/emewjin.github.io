---
title: Cypress로 프론트엔드 테스트코드 작성하기
date: 2022-04-15
lastUpdated: 2022-04-15
description: 'Cypress로 프론트엔드 테스트코드 작성하기'
tags: [Cypress, TestCode]
---

바빴던 프로젝트 런칭 기간이 끝나고, 그보다는 여유가 있는 템포로 새로운 피쳐들을 개발하거나 리팩토링을 진행하고 있다. 조금이나마 생긴 시간적 여유로는 요즘 cypress를 이용한 테스트를 작성해보고 있는데 그 과정에서 새로 알게되는 점들을 위키로 기록하려고 한다.

## 왜 씀? 장점!
일단 솔직히 말하자면 cypress 테스트를 작성하는 이유는 다음과 같다.
- **유닛 테스트에 비해 테스트 작성 난이도가 쉽다.** 

  유닛 테스트를 작성하려니 redux 모킹하고 react query 모킹하고 머리가 너무 아팠다. 유닛 테스트를 쉽게 짜기 위해서는 유닛 테스트를 쉽게 짤 수 있는 코드를 먼저 짜야한다. 또한 위에서 이야기했던 각종 라이브러리들을 모킹하지 않고, 그냥 api 콜만 모킹하면 된다!! (참 쉽죠 짤.jpg) 지금 당장 안정적인 리팩토링을 위해 최소한의 테스트코드가 필요한 입장에서는, cypress가 최선의 선택이었다고 생각한다.

- **유닛 테스트로는 확인할 수 없는 사용자 플로우 상의 엣지케이스를 발견할 수 있다.**

  현재 프로젝트에서는 독립적인 함수 (특히 유틸성 함수) 에 대해서 유닛테스트를 작성하고 있고, 뭐를 클릭하면 어떤 이벤트가 발생한다거나 하는 유저 플로우 적인 측면에 대한 유닛테스트는 존재하지 않다. cypress를 이용한 e2e 테스트는 확실히 유닛 테스트보다 직관적이고 유저플로우에 가깝기 때문에 엣지케이스를 발견하기가 좋다.

- **PO가 작성해주시는 인수조건을 그대로 테스트로 옮길 수 있다.**

  가끔 PO의 인수조건이 개발자의 테스트와 동일하다는 생각도 든다.

- **리팩토링시 최소한의 안정성 확보**

- **웹 접근성을 준수하여 개발하게 됨**

  당장 그렇게 개발 안 했더라도, 테스트를 작성하다보면 자연히 그렇게 리팩토링하게 된다.

## 단점

- **너무 느림**

  빨리빨리의 민족 한국인 입장에서는 속이 터질 수 있다. cypress를 실행하는 방법으로 크게 두 가지가 있는데, 백엔드 서버를 모킹하는 것은 똑같고 (1) 프론트는 로컬 환경으로 실행시킨다 (2) 프론트를 빌드해서 실행시킨다 두 가지 선택지가 있다. 둘 중에서 편한 것은 1번이지만 (수정할 때마다 빌드하면 시간이 너무 많이 듦) 테스트 실행 속도가 빠른것은 2번이 압도적이다. 

  얼마 전에 26개의 테스트 케이스를 돌리는데 무려 80초대가 나왔다. 정말 경악스러운 속도가 아닐 수 없다. 

  개인적으로 cypress를 이용한 테스트 작성의 관건은 속도를 얼마나 단축시킬 수 있냐일듯 하다.

- **일부만 테스트하거나 fail된 테스트만 rerun이 안됨**
  
  cypress가 유명한 도구이다보니 jest에서 지원하는 건 웬만하면 다 되겠지? 하고 생각했는데 착각이었다. 특히 저 두 개가 안될 줄은 정말 몰랐다. 진짜루.

  cypress는 테스트 파일 하나하나를 spec이라고 부르는데, 그 spec 안에서도 다양한 context와 it이 있다. 이 it을 원하는 것만 돌리는 방법을 모르겠다. 지금까지 파악한 유일한 방법은 다른 케이스를 모두 주석처리하고 원하는 것만 살리는 것이다....:( fail된 케이스도 마찬가지이다.

## 기술가이드 (팁?)

- 기본적으로 돔 요소를 선택하여 테스트를 하기 때문에 테스트하려는 요소가 visible 하지 않거나 다른 요소에 의해 가려지게되면 답이 없다.
- Next.js에서는 next 서버가 따로 있기 때문에 테스트를 위한 mock server를 구축해야 한다.
- 브라우저(클라이언트)에서의 http 통신은 cypress의 fixture로 커버가 가능하다

...작성중
