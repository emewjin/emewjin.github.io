---
title: (ë²ˆì—­) êµë¬˜í•œ ë¦¬ì•¡íŠ¸ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ - ë¦¬ì•¡íŠ¸ ì»´íŒŒì¼ëŸ¬ê°€ ë‹¹ì‹ ì„ êµ¬í•˜ì§€ ëª»í•˜ëŠ” ì´ìœ 
date: 2024-07-22
lastUpdated: 2024-07-22
tags: [React, ë²ˆì—­]
---

> ì›ë¬¸: [Sneaky React Memory Leaks: How the React compiler won't save you](https://schiener.io/2024-07-07/react-closures-compiler)

![](./1.png)

ëª‡ ì£¼ ì „ì— ì €ëŠ” ë¦¬ì•¡íŠ¸ì—ì„œ `useCallback`ì´ë‚˜ `useEffect` ê°™ì€ ë©”ëª¨ì´ì œì´ì…˜ í›…ì„ ì‚¬ìš©í•  ë•Œ, [í´ë¡œì €ê°€ ì–´ë–»ê²Œ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ë¥¼ ì¼ìœ¼í‚¬ ìˆ˜ ìˆëŠ” ì§€ì— ëŒ€í•œ ê¸€](https://schiener.io/2024-03-03/react-closures)ì„ ì¼ìŠµë‹ˆë‹¤. ì´ ê¸€ì€ [TLDR WebDev](https://tldr.tech/webdev), https://bytes.dev/, [This Week In React](https://thisweekinreact.com/)ì™€ ê°™ì€ ë©‹ì§„ ë‰´ìŠ¤ë ˆí„° ë° Xì—ì„œ ì£¼ëª©ì„ ë°›ì•˜ìŠµë‹ˆë‹¤ (ì‘ì›í•´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤! ğŸ™).

ë‹¹ì—°íˆ ë§ì€ ì‚¬ëŒë“¤ì´ ì œê°€ ë³´ì—¬ë“œë¦° ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ê°€ ìƒˆë¡œìš´ ë¦¬ì•¡íŠ¸ ì»´íŒŒì¼ëŸ¬ì—ì„œ ì–´ë–»ê²Œ ì²˜ë¦¬ë ì§€ ê¶ê¸ˆí•´í–ˆìŠµë‹ˆë‹¤. ë¦¬ì•¡íŠ¸ íŒ€ì˜ ë‹µë³€ì€ ì•„ë˜ì™€ ê°™ì•˜ìŠµë‹ˆë‹¤.

<blockquote class="twitter-tweet" data-dnt="true" align="center"><p lang="en" dir="ltr">the compiler will cache these values so they won&#39;t keep getting re-allocated and memory won&#39;t grow infinitely</p>&mdash; Sathya Gunasekaran (@_gsathya) <a href="https://twitter.com/_gsathya/status/1795766442786218435?ref_src=twsrc%5Etfw">May 29, 2024</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

ê·¸ëŸ´ë“¯í•˜ê²Œ ë“¤ë¦¬ì£ ? í•˜ì§€ë§Œ ì–¸ì œë‚˜ ê·¸ë ‡ë“¯ì´, ê·¸ ë‚´ë©´ì— í•¨ì •ì´ ìˆìŠµë‹ˆë‹¤. ì´ ì£¼ì œì— ëŒ€í•´ ìì„¸íˆ ì•Œì•„ë³´ê³  ì´ì „ ê¸€ë¡œë¶€í„° ë¦¬ì•¡íŠ¸ ì»´íŒŒì¼ëŸ¬ê°€ ì½”ë“œë¥¼ ì–´ë–»ê²Œ ì²˜ë¦¬í•˜ëŠ”ì§€ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.

**ë°”ìœ ë¶„ë“¤ì„ ìœ„í•œ TLDR**: ë¦¬ì•¡íŠ¸ ì»´íŒŒì¼ëŸ¬ëŠ” ë‹¤ë¥¸ ê²ƒì— ì˜ì¡´í•˜ì§€ ì•ŠëŠ” ê°’ì„ ìºì‹±í•˜ë¯€ë¡œ ê³„ì† ì¬í• ë‹¹ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ í´ë¡œì €ë¡œ ì¸í•œ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ë¥¼ ë°©ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ë‹¤ë¥¸ ê°’ì— ì˜ì¡´í•˜ëŠ” í´ë¡œì €ë¡œ ì¸í•œ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ë¥¼ ë°©ì§€í•˜ì§€ëŠ” ëª»í•©ë‹ˆë‹¤. ì—¬ì „íˆ ë¬¸ì œë¥¼ ì¸ì§€í•˜ê³  ê·¸ì— ë”°ë¼ ì½”ë“œë¥¼ ì‘ì„±í•´ì•¼ í•©ë‹ˆë‹¤.

## ìš”ì•½: í´ë¡œì € ê·¸ë¦¬ê³  ë©”ëª¨ë¦¬ ëˆ„ìˆ˜

ì´ì „ ê¸€ì—ì„œ í´ë¡œì €ê°€ ì–´ë–»ê²Œ ë¦¬ì•¡íŠ¸ì—ì„œ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ë¡œ ì´ì–´ì§ˆ ìˆ˜ ìˆëŠ”ì§€ì— ëŒ€í•´ ì„¤ëª…í–ˆìŠµë‹ˆë‹¤. ìš”ì ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

1. í´ë¡œì €ëŠ” **ì™¸ë¶€ ìŠ¤ì½”í”„**ì—ì„œ ë³€ìˆ˜ë¥¼ ìº¡ì²˜í•©ë‹ˆë‹¤. ë¦¬ì•¡íŠ¸ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì´ëŠ” ì¢…ì¢… ìƒíƒœ, í”„ë¡œí¼í‹° ë˜ëŠ” ë©”ëª¨ì´ì œì´ì…˜ëœ ê°’ì„ ìº¡ì³í•˜ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.
2. ì»´í¬ë„ŒíŠ¸ì˜ ëª¨ë“  í´ë¡œì €ëŠ” ìº¡ì²˜ëœ ë³€ìˆ˜ê°€ ì €ì¥ë˜ëŠ” **ë™ì¼í•œ ë”•ì…”ë„ˆë¦¬ ìŠ¤íƒ€ì¼ ê°ì²´(ì»¨í…ìŠ¤íŠ¸ ê°ì²´)ë¥¼ ê³µìœ í•©ë‹ˆë‹¤.** (ê° ë‚´ë¶€ í´ë¡œì €ê°€ ì•„ë‹Œ, ì»´í¬ë„ŒíŠ¸ë‹¹ í•˜ë‚˜ì˜ ê°ì²´)
3. ì»¨í…ìŠ¤íŠ¸ ê°ì²´ëŠ” ì»´í¬ë„ŒíŠ¸ í•¨ìˆ˜ê°€ í˜¸ì¶œë  ë•Œ í•œ ë²ˆ ìƒì„±ë˜ë©°, **ë§ˆì§€ë§‰ í´ë¡œì €ê°€ ê°€ë¹„ì§€ ì»¬ë ‰í„°ì— ì˜í•´ ìˆ˜ê±°ë  ìˆ˜ ìˆì„ ë•Œê¹Œì§€ ìœ ì§€ë©ë‹ˆë‹¤.**
4. ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ê²ƒë¶€í„° ëª¨ë“  í˜•ì œ í´ë¡œì €ë¡œë¶€í„° **ìº¡ì³ëœ ê° ë³€ìˆ˜ê°€** ì´ ê°ì²´ì— ì¶”ê°€ë©ë‹ˆë‹¤.
5. í´ë¡œì € ì¤‘ í•˜ë‚˜ë¥¼ ìºì‹œ/ë©”ëª¨ì´ì œì´ì…˜í•˜ë©´ ë‹¤ë¥¸ í´ë¡œì €ê°€ ë” ì´ìƒ ì‚¬ìš©ë˜ì§€ ì•Šë”ë¼ë„ **ì „ì²´ ì»¨í…ìŠ¤íŠ¸ ê°ì²´**ê°€ ìœ ì§€ë©ë‹ˆë‹¤.

ì´ëŠ” í´ë¡œì € ì¤‘ í•˜ë‚˜ê°€ í° ë°°ì—´ê³¼ ê°™ì€ í° ê°ì²´ë¥¼ ì°¸ì¡°í•˜ëŠ” ê²½ìš° íŠ¹íˆ ì¤‘ìš”í•©ë‹ˆë‹¤. ì•„ë˜ ìŠ¤í¬ë¦°ìƒ·ì—ì„œ `handleClick`ì´ "Closure (App)" ìŠ¤ì½”í”„ì— ëŒ€í•´ ì•¡ì„¸ìŠ¤ ê¶Œí•œì„ ê°€ì§€ê³  ìˆìŒì„ ëª…í™•í•˜ê²Œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ìŠ¤ì½”í”„ì—ëŠ” `logLength`ì—ì„œë§Œ ì‚¬ìš©ë˜ëŠ” `bigData`ë„ í¬í•¨ë©ë‹ˆë‹¤.

![í˜•ì œ í´ë¡œì €ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•œ í° ë°°ì—´ì„ ê°€ì§„ ê³µìœ ëœ í´ë¡œì €](./closure-scope.png 'í˜•ì œ í´ë¡œì €ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•œ í° ë°°ì—´ì„ ê°€ì§„ ê³µìœ ëœ í´ë¡œì €')

ë˜í•œ ê¹Šê²Œ ì¤‘ì²©ëœ `useCallback` ì°¸ì¡° ì²´ì¸ê³¼ ê°™ì€ í¥ë¯¸ë¡œìš´ ë¶€ìˆ˜ íš¨ê³¼ê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì•„ë˜ì—ì„œ ì•ˆíƒ€ê¹Œìš´ ë°©ì‹ìœ¼ë¡œ ìƒíƒœë¥¼ ë³€ê²½í•˜ë©´ ë©”ëª¨ì´ì œì´ì…˜ëœ í•¨ìˆ˜ì˜ ê¸´ `useCallback` ì²´ì¸ì´ ì–´ë–»ê²Œ ìƒì„±ë˜ëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![`handleClicks` ì…ë‹ˆë‹¤.](./call-chain-focused.png '`handleClicks` ì…ë‹ˆë‹¤.')

ì´ê²ƒì€ ëŒ€ì²´ë¡œ í•¨ìˆ˜í˜• ìë°”ìŠ¤í¬ë¦½íŠ¸ì˜ ê·¼ë³¸ì ì¸ 'ë¬¸ì œ'ì´ì§€ ë¦¬ì•¡íŠ¸ì˜ ë¬¸ì œëŠ” ì•„ë‹™ë‹ˆë‹¤. ë‹¤ë§Œ ë¦¬ì•¡íŠ¸ëŠ” í´ë¡œì €ì™€ ë©”ëª¨ì´ì œì´ì…˜ì„ ë§ì´ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— ì´ ë¬¸ì œê°€ ë°œìƒí•  ê°€ëŠ¥ì„±ì´ í›¨ì”¬ ë” ë†’ìŠµë‹ˆë‹¤. ì„¤ê³„ë˜ì§€ ì•Šì€ ì–¸ì–´ì— í•¨ìˆ˜í˜• í”„ë¡œê·¸ë˜ë° íŒ¨ëŸ¬ë‹¤ì„ì„ ì ìš©í•˜ëŠ” ê²ƒì€ ë‹¨ì ì¼ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. (í•˜ì§€ë§Œ ì´ëŠ” ë˜ ë‹¤ë¥¸ ì£¼ì œì…ë‹ˆë‹¤.)

## ë¦¬ì•¡íŠ¸ ì»´íŒŒì¼ëŸ¬

ìƒˆë¡œìš´ [ë¦¬ì•¡íŠ¸ ì»´íŒŒì¼ëŸ¬](https://react.dev/learn/react-compiler)ì— ëŒ€í•´ ë“¤ì–´ë³´ì…¨ì„ ê²ƒì…ë‹ˆë‹¤. ë¦¬ì•¡íŠ¸ íŒ€ì€ ì½”ë“œë¥¼ ë³´ë‹¤ ìµœì í™”ëœ ë²„ì „ìœ¼ë¡œ ë°”ê¿”ì¤„ ìƒˆë¡œìš´ ë¹Œë“œ ë„êµ¬ë¥¼ ì—´ì‹¬íˆ ê°œë°œí•˜ê³  ìˆìŠµë‹ˆë‹¤. ì•„ì§ ê°œë°œ ì¤‘ì´ì§€ë§Œ ëª¨ë“  ë©”ëª¨ì´ì œì´ì…˜ì„ ì»´íŒŒì¼ëŸ¬ì— ìœ„ì„í•˜ëŠ” ê²ƒì´ ëª©í‘œì…ë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ ë” ì´ìƒ `useCallback`ë¥¼ ì–´ë””ì— ë„£ì„ì§€ ê³ ë¯¼í•  í•„ìš”ê°€ ì—†ê³  ì½”ë“œë¥¼ ê°„ê²°í•˜ê³  ê°€ë…ì„± ìˆê²Œ ìœ ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

Xì—ì„œ í´ë¡œì € ëˆ„ìˆ˜ì— ëŒ€í•´ ë°›ì•˜ë˜ ì‘ë‹µì„ ë¯¿ì–´ë³´ë©´, ì»´íŒŒì¼ëŸ¬ëŠ” "ë¬´ì–¸ê°€"ë¥¼ ìºì‹±í•˜ì—¬ ëˆ„ìˆ˜ë¥¼ ë°©ì§€í•  ìˆ˜ ìˆë‹¤ëŠ” ì–˜ê¸°ì¼ ê²ë‹ˆë‹¤. í•˜ì§€ë§Œ ì •í™•íˆ ë¬´ì—‡ì„ ìºì‹±í•˜ëŠ” ê²ƒì¼ê¹Œìš”? ê·¸ë¦¬ê³  ì–´ë–»ê²Œ ëˆ„ìˆ˜ë¥¼ ë°©ì§€í•  ìˆ˜ ìˆì„ê¹Œìš”? ì•Œì•„ë´…ì‹œë‹¤.

## ëˆ„ìˆ˜ê°€ ë°œìƒí•˜ëŠ” ì½”ë“œ

ì•„ë˜ëŠ” ì´ì „ ê¸€ì˜ ì½”ë“œì¸ë°, 'Increment A'ì™€ 'Increment B' ë²„íŠ¼ì„ ë²ˆê°ˆì•„ í´ë¦­í•˜ë©´ ê°€ë¹„ì§€ ì»¬ë ‰ì…˜ì´ ë°œìƒí•˜ì§€ ì•ŠëŠ” `BigObject`ê°€ ìƒˆë¡œ í• ë‹¹ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```tsx
import { useState, useCallback } from 'react';

class BigObject {
  public readonly data = new Uint8Array(1024 * 1024 * 10);
}

export const App = () => {
  const [countA, setCountA] = useState(0);
  const [countB, setCountB] = useState(0);
  const bigData = new BigObject(); // 10MB ë°ì´í„°

  const handleClickA = useCallback(() => {
    setCountA(countA + 1);
  }, [countA]);

  const handleClickB = useCallback(() => {
    setCountB(countB + 1);
  }, [countB]);

  // ë¬¸ì œë¥¼ ë³´ì—¬ë“œë¦¬ê¸° ìœ„í•´ì„œë§Œ ì¡´ì¬í•©ë‹ˆë‹¤
  const handleClickBoth = () => {
    handleClickA();
    handleClickB();
    console.log(bigData.data.length);
  };

  return (
    <div>
      <button onClick={handleClickA}>Increment A</button>
      <button onClick={handleClickB}>Increment B</button>
      <button onClick={handleClickBoth}>Increment Both</button>
      <p>
        A: {countA}, B: {countB}
      </p>
    </div>
  );
};
```

## ë¦¬ì•¡íŠ¸ ì»´íŒŒì¼ëŸ¬ ì‚¬ìš© í›„ ëŸ°íƒ€ì„ ë™ì‘

ì´ ì½”ë“œë¥¼ ë¦¬ì•¡íŠ¸ ì»´íŒŒì¼ëŸ¬ì—ì„œ ì‹¤í–‰í•˜ê³  ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ë¥¼ ì¬í˜„í•´ ë³´ë©´ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì´ ì¼ì •í•˜ê²Œ ìœ ì§€ë˜ê³  ë©”ëª¨ë¦¬ ìŠ¤ëƒ…ìƒ·ì— `BigObject` ì¸ìŠ¤í„´ìŠ¤ê°€ í•˜ë‚˜ë§Œ í• ë‹¹ë˜ì–´ ìˆëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![ë‹¨ í•˜ë‚˜ì˜ `BigObject`ë§Œ í• ë‹¹ë˜ê³  ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì€ ì¼ì •í•˜ê²Œ ìœ ì§€ë©ë‹ˆë‹¤.](./compiler-first-try.png 'ë‹¨ í•˜ë‚˜ì˜ `BigObject`ë§Œ í• ë‹¹ë˜ê³  ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì€ ì¼ì •í•˜ê²Œ ìœ ì§€ë©ë‹ˆë‹¤.')

ë¯¸ë˜ê°€ ë°ì•„ ë³´ì´ì£ ? í•˜ì§€ë§Œ ì»´íŒŒì¼ëœ ì½”ë“œë¥¼ ìì„¸íˆ ì‚´í´ë³´ê³  ì»´íŒŒì¼ëŸ¬ê°€ ë¬´ì—‡ì„ í•˜ê³  ìˆëŠ”ì§€ ì‚´í´ë´…ì‹œë‹¤.

## ì»´íŒŒì¼ëœ ì½”ë“œ ìì„¸íˆ ë³´ê¸°

Vite í”„ë¡œì íŠ¸ì— ë¦¬ì•¡íŠ¸ ì»´íŒŒì¼ëŸ¬ë¥¼ ì¶”ê°€í•˜ê³  ì½”ë“œë¥¼ ì‹¤í–‰í•´ ë³´ì•˜ìŠµë‹ˆë‹¤. ì»´íŒŒì¼ëŸ¬ ì¶œë ¥ì€ ì•½ê°„ ì¥í™©í•˜ì§€ë§Œ ê´€ë ¨ ë¶€ë¶„ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

```tsx
const App = () => {
  const $ = compilerRuntimeExports.c(22);
  const [countA, setCountA] = reactExports.useState(0);
  const [countB, setCountB] = reactExports.useState(0);
  let t0;
  if ($[0] === Symbol.for('react.memo_cache_sentinel')) {
    t0 = new BigObject();
    $[0] = t0;
  } else {
    t0 = $[0];
  }
  const bigData = t0;
  // ...
};
```

í›Œë¥­í•œ [ë¦¬ì•¡íŠ¸ ì»´íŒŒì¼ëŸ¬ í”Œë ˆì´ê·¸ë¼ìš´ë“œ](https://playground.react.dev/#N4Igzg9grgTgxgUxALhASwLYAcIwC4AEwBUYCAyngIZ4IA0JZAwlQDasBGVcA1gQL4EAZjAgYCAHRAwE3PFIDcEgHYq4rKmDAEAQmgDmAeQ4ArBHELAVBAligdWaOARlUAJhGWsAngTc0qAgBeAmUEAHcCAFU0ZTwADgBBGBgqbwAKAEYABgAmABYCACoCHILi0uyASiVlfhUVBAAPHHxhKGULNE8CRKwsdKqiawI4TzBCAG0xjrxEhjI8Jmg4xIBdYMYKalp06tqbMeUJgmmVvB0FhCXznQ2Q0m2aBD2akaOTjgMAEQDNsMieiMpnMeEGCgIAHpIZUALI6AgQIR+AINZSHcaEAAWVGUblYCCYjl4iU2jxY7C4vHSg2CAD5huibARFstZol0jNVgQANSlN5M-gMM7stYC96Ygg4vEEolOHgIh7MNicbg8GlDIIMqxMmys26c268-kHATCrkXMW1EbQggAFSxaG0nh8BGaTrw2jwED8CAwmNStAIeCxCFsogcfolx2xuPxhOJCogIc2tK1jOZUrjssTHIFmel8blvB04JGGOOEAJADpWBB9OkvvpftRq-5WwTlPoQ-mBNamTI8LB0elywQADxuNAANzpY5s444UDw3vRnmLPCCwELOfliX4dIAkp0ZBgEHFeuPIUuV5457rmYvl6vEcoN1udwn5ToD8e4Kfz0IHQrxvVd70zBdQJ6ddEw-bMvxLZMsV-E8-UA3QkJA5873nCcsHAiCbESZAiAtfcGB0EjgAtH9cKvfCxyvKdZxGAV+AUEB+CAA)ì—ì„œ ì „ì²´ ì¶œë ¥ì„ í™•ì¸í•˜ì‹¤ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

ì»´íŒŒì¼ëŸ¬ëŠ” ë©”ëª¨ì´ì œì´ì…˜ëœ ê°’ì„ ìºì‹œí•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” ìƒˆë¡œìš´ ë³€ìˆ˜ `$`ë¥¼ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤. ë˜í•œ ìºì‹œëœ ê°’ì„ ë¬´íš¨í™”í•˜ëŠ” ì°¸ì¡° ê²€ì‚¬ë¥¼ `if()`ì— ì¸ë¼ì¸ ì²˜ë¦¬í–ˆìŠµë‹ˆë‹¤. ì´ê²ƒì´ ë°”ë¡œ ì˜ì¡´ì„± ë°°ì—´ì˜ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì¼ì–´ë‚œ ì¼ì…ë‹ˆë‹¤.

ì´ì œ `BigObject`ê°€ í•œ ë²ˆë§Œ ìƒì„±ë˜ì–´ ìºì‹œì— ì €ì¥ë©ë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ ì»´í¬ë„ŒíŠ¸ë¥¼ ë Œë”ë§í•  ë•Œë§ˆë‹¤ `BigObject`ê°€ ë” ì´ìƒ ìƒì„±ë˜ì§€ ì•Šìœ¼ë¯€ë¡œ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ë¥¼ ë°©ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

`BigObject`ëŠ” ìƒíƒœë‚˜ í”„ë¡œí¼í‹°ì— ëŒ€í•œ ì¢…ì†ì„±ì´ ì—†ìœ¼ë¯€ë¡œ ì»´íŒŒì¼ëŸ¬ëŠ” ì•ˆì „í•˜ê²Œ ìºì‹±í•  ìˆ˜ ìˆë‹¤ê³  ê°€ì •í•©ë‹ˆë‹¤. ì´ëŠ” ì›ë³¸ ì½”ë“œì—ì„œ `const bigData = useMemo(() => new BigObject(), [])`ë¥¼ ì‘ì„±í•˜ëŠ” ê²ƒê³¼ ë™ì¼í•©ë‹ˆë‹¤.

> ğŸ’¡ ì´ê²ƒì€ ë¦¬ì•¡íŠ¸ì—ì„œ _ìˆœìˆ˜ ì»´í¬ë„ŒíŠ¸_ ë¥¼ ì‘ì„±í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•œ ì´ìœ ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤. ê° ë Œë”ë§ì€ ë™ì¼í•œ í”„ë¡œí¼í‹°ì™€ ìƒíƒœê°€ ì£¼ì–´ì¡Œì„ ë•Œ ë™ì¼í•œ ì¶œë ¥ì„ ìƒì„±í•´ì•¼ í•©ë‹ˆë‹¤. ì œ ì˜ˆì‹œì—ì„œëŠ” ë Œë”ë§í•  ë•Œë§ˆë‹¤ ìƒˆë¡œìš´ `BigObject`ë¥¼ ìƒì„±í•˜ì—¬ ì´ ê·œì¹™ì„ ìœ„ë°˜í–ˆê³ , ì´ ìƒˆë¡œìš´ ì¸ìŠ¤í„´ìŠ¤ì— ì˜ì¡´í•˜ì—¬ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ë¥¼ ë³´ì—¬ì£¼ì—ˆìŠµë‹ˆë‹¤.

ì´ê²ƒì´ Sathyaê°€ Xì—ì„œ ì‘ë‹µí•œ ë‚´ìš©ì…ë‹ˆë‹¤. ë¦¬ì•¡íŠ¸ ì»´íŒŒì¼ëŸ¬ëŠ” _ë‹¤ë¥¸ ì–´ëŠ ê²ƒì—ë„ ì˜ì¡´í•˜ì§€ ì•ŠëŠ” ê°’_ ì„ ìºì‹±í•˜ë¯€ë¡œ ê³„ì† ì¬í• ë‹¹ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì•ˆíƒ€ê¹ê²Œë„ ì´ë ‡ê²Œ í•´ë„ ë¬¸ì œëŠ” í•´ê²°ë˜ì§€ ì•Šê³  ì œ ì˜ˆì œê°€ ë” ì´ìƒ ì‘ë™í•˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ê²ƒì„ ë³´ì—¬ì¤„ ë¿ì…ë‹ˆë‹¤. í¬ë¡¬ ê°œë°œì ë„êµ¬ì—ì„œ ê°€ì¥ ê¸´ ê±°ë¦¬ë¥¼ ê°€ì§„ ë¦¬í…Œì´ë„ˆ(retainer)ë¥¼ ë³´ë©´ ì‰½ê²Œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![ì—¬ì „íˆ ë‹¤ì–‘í•œ ì½œë°±ì˜ ê¸´ ì°¸ì¡° ì²´ì¸ì´ ë²ˆê°ˆì•„ ê°€ë©° ì¡´ì¬í•©ë‹ˆë‹¤.](./call-chain.png 'ì—¬ì „íˆ ë‹¤ì–‘í•œ ì½œë°±ì˜ ê¸´ ì°¸ì¡° ì²´ì¸ì´ ë²ˆê°ˆì•„ ê°€ë©° ì¡´ì¬í•©ë‹ˆë‹¤.')

## ì½”ë“œë¥¼ ë³€ê²½í•˜ì—¬ ëˆ„ìˆ˜ë¥¼ ë‹¤ì‹œ ë°œìƒì‹œì¼œ ë³´ê¸°

ì´ì œ ë¦¬ì•¡íŠ¸ ì»´íŒŒì¼ëŸ¬ê°€ ì–´ë–»ê²Œ ì‘ë™í•˜ëŠ”ì§€ ì´í•´í–ˆìœ¼ë‹ˆ ì½”ë“œë¥¼ ì‰½ê²Œ ë³€ê²½í•˜ëŠ” ê²ƒìœ¼ë¡œ ì‚¬ë‘ìŠ¤ëŸ¬ìš´ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ë¥¼ ë‹¤ì‹œ ë°œìƒì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```tsx
import { useState, useCallback } from 'react';

class BigObject {
  constructor(public state: string) {}
  public readonly data = new Uint8Array(1024 * 1024 * 10);
}

export const App = () => {
  const [countA, setCountA] = useState(0);
  const [countB, setCountB] = useState(0);
  const bigData = new BigObject(`${countA}/${countB}`); // 10MB ë°ì´í„°

  // ë‚˜ë¨¸ì§€ ì½”ë“œëŠ” ë™ì¼í•©ë‹ˆë‹¤
  // ...
};
```

ì´ì œ `countA`ì™€ `countB` ìƒíƒœë¥¼ `BigObject` ìƒì„±ìì— ì „ë‹¬í•˜ë©´ ê° ìƒíƒœ ë³€ê²½ì— ëŒ€í•´ ìƒˆ ì¸ìŠ¤í„´ìŠ¤ê°€ ìƒì„±ë©ë‹ˆë‹¤. ë§ë¶™ì—¬ì„œ, ì´ê²ƒì€ ìš°ë¦¬ê°€ ê²½í—˜í–ˆë˜ ì›ë˜ í”„ë¡œë•ì…˜ ë¬¸ì œì™€ë„(ì²« ë²ˆì§¸ ê¸€ì˜ ë°œë‹¨ì´ ëœ) ì¡°ê¸ˆ ë” ê°€ê¹ìŠµë‹ˆë‹¤.

ì´ì œ ì»´íŒŒì¼ëœ ê²°ê³¼ë¥¼ í™•ì¸í•˜ë©´ `countA` ë° `countB` ìƒíƒœì— ëŒ€í•œ ì¢…ì†ì„±ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```tsx
const App = () => {
  const $ = compilerRuntimeExports.c(24);
  const [countA, setCountA] = reactExports.useState(0);
  const [countB, setCountB] = reactExports.useState(0);
  const t0 = `${countA}/${countB}`;
  let t1;
  if ($[0] !== t0) {
    t1 = new BigObject(t0);
    $[0] = t0;
    $[1] = t1;
  } else {
    t1 = $[1];
  }
  const bigData = t1;
  // ...
};
```

ê·¸ë¦¬ê³  ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ê°€ ë‹¤ì‹œ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì´ì œ ë Œë”ë§í•  ë•Œë§ˆë‹¤ `BigObject`ê°€ ìƒì„±ë˜ë©° ê°€ë¹„ì§€ ì»¬ë ‰í„°ì— ì˜í•´ ìˆ˜ê±°ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë²„íŠ¼ì„ í´ë¦­í•  ë•Œë§ˆë‹¤ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì´ ì¦ê°€í•©ë‹ˆë‹¤.

![ë²„íŠ¼ì„ í´ë¦­í•  ë•Œë§ˆë‹¤ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì´ ì¦ê°€í•©ë‹ˆë‹¤.](./still-leaking.png 'ë²„íŠ¼ì„ í´ë¦­í•  ë•Œë§ˆë‹¤ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì´ ì¦ê°€í•©ë‹ˆë‹¤.')

## ëª¨ë“  ë©”ëª¨ì´ì œì´ì…˜ì„ ì œê±°í•˜ë©´ ì–´ë–¨ê¹Œìš”?

í”„ë¡œë•ì…˜ì—ì„œ ì´ ë¬¸ì œì— ì§ë©´í–ˆì„ ë•Œ, `handleClickBoth` í•¨ìˆ˜ì—ì„œ ë³¼ ìˆ˜ ìˆëŠ” ì´ëŸ¬í•œ ìƒí˜¸ ì°¸ì¡° í´ë¡œì €ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ ë§ì€ ë©”ëª¨ì´ì œì´ì…˜ì„ ì œê±°í–ˆìŠµë‹ˆë‹¤. ì´ í•¨ìˆ˜ëŠ” ë‹¤ë¥¸ ë‘ í•¸ë“¤ëŸ¬ë¥¼ ì°¸ì¡°í•˜ê¸° ë•Œë¬¸ì— ë©”ëª¨ì´ì œì´ì…˜ëœ ê°’ì´ ì‹¤ì œë¡œëŠ” íš¨ê³¼ê°€ ì—†ìœ¼ë©°, ë³€ê²½ ì‚¬í•­ì„ ì¶”ë¡ í•˜ê¸°ê°€ í›¨ì”¬ ë” ì–´ë ¤ì›Œì§‘ë‹ˆë‹¤.

ì´ì œ ë¦¬ì•¡íŠ¸ ì»´íŒŒì¼ëŸ¬ë¥¼ ì‚¬ìš©í•˜ë©´ ì´ ì±…ì„ì„ ë„êµ¬ì— ìœ„ì„í•˜ê¸° ë•Œë¬¸ì— ë”ìš± ì£¼ì˜í•´ì•¼ í•©ë‹ˆë‹¤. ì•„ë˜ ì½”ë“œì—ëŠ” ë©”ëª¨ì´ì œì´ì…˜ì´ ì „í˜€ ì—†ìŠµë‹ˆë‹¤.

```tsx
import { useState } from 'react';

class BigObject {
  constructor(public state: string) {}
  public readonly data = new Uint8Array(1024 * 1024 * 10);
}

export const App = () => {
  const [countA, setCountA] = useState(0);
  const [countB, setCountB] = useState(0);
  const bigData = new BigObject(`${countA}/${countB}`); // 10MB ë°ì´í„°

  const handleClickA = () => {
    setCountA(countA + 1);
  };

  const handleClickB = () => {
    setCountB(countB + 1);
  };

  // ë¬¸ì œë¥¼ ë³´ì—¬ë“œë¦¬ê¸° ìœ„í•´ì„œë§Œ ì¡´ì¬í•©ë‹ˆë‹¤
  const handleClickBoth = () => {
    handleClickA();
    handleClickB();
    console.log(bigData.data.length);
  };

  return (
    <div>
      <button onClick={handleClickA}>Increment A</button>
      <button onClick={handleClickB}>Increment B</button>
      <button onClick={handleClickBoth}>Increment Both</button>
      <p>
        A: {countA}, B: {countB}
      </p>
    </div>
  );
};
```

í•˜ì§€ë§Œ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ëŠ” ì»´íŒŒì¼ëŸ¬ì˜ ë©”ëª¨ì´ì œì´ì…˜ ë§ˆë²•ì— ì˜í•´ ë‹¤ì‹œ ì¶”ê°€ë©ë‹ˆë‹¤. ì»´íŒŒì¼ëŸ¬ê°€ ê¸°ë³¸ê°’ì´ ëœ í›„ ë¦¬ì•¡íŠ¸ë¥¼ ì²˜ìŒ ì‚¬ìš©í•˜ëŠ” ê°œë°œìë¼ë©´ ì´ ë¬¸ì œë¥¼ ì¸ì‹í•˜ê³  ë””ë²„ê¹…í•˜ê³  ìˆ˜ì •í•˜ê¸°ê°€ ë§¤ìš° ì–´ë ¤ìš¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![ì—¬ì „íˆ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ê°€ ìˆì§€ë§Œ ì´ì œ ì»´íŒŒì¼ëŸ¬ê°€ ë©”ëª¨ì´ì œì´ì…˜ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.](./no-memoization.png 'ì—¬ì „íˆ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ê°€ ìˆì§€ë§Œ ì´ì œ ì»´íŒŒì¼ëŸ¬ê°€ ë©”ëª¨ì´ì œì´ì…˜ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.')

## `bind(null, x)`ë¥¼ ì‚¬ìš©í•œ ì‹¤í—˜ì  í•´ê²° ë°©ë²•

ì´ì „ ê¸€ì— ëŒ€í•œ ì¼ë¶€ ëŒ“ê¸€ì—ì„œ ì˜ê°ì„ ë°›ì•„ ì´ ë¬¸ì œì— ëŒ€í•œ ì ‘ê·¼ ë°©ì‹ í•˜ë‚˜ë¥¼ ìƒê°í•´ëƒˆìŠµë‹ˆë‹¤. í´ë¡œì €ë¥¼ ì™„ì „íˆ ìš°íšŒí•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ëŒ€ì‹  `bind`ë¥¼ ì‚¬ìš©í•˜ì—¬ í•„ìˆ˜ ê°’ì„ í•¨ìˆ˜ì— ì§ì ‘ ì „ë‹¬í•´ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. `bind`ë¥¼ ì‚¬ìš©í•˜ë©´ ëª¨ë“  í´ë¡œì € ê°„ì— ê³µìœ ë˜ëŠ” ì»¨í…ìŠ¤íŠ¸ ê°ì²´ì— ì˜ì¡´í•  í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤. ì´ ì ‘ê·¼ ë°©ì‹ì€ ì¢€ ë” ì¥í™©í•˜ì§€ë§Œ ì´ëŸ¬í•œ ì¢…ë¥˜ì˜ ê³¼ë„í•œ í´ë¡œì €ë¥¼ ë°©ì§€í•˜ëŠ” ì¢‹ì€ ë°©ë²•ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. DXë„ íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ ì¶”ë¡ ê³¼ í•¨ê»˜ë¼ë©´ ê·¸ë ‡ê²Œ ë‚˜ì˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

```tsx
import { useState } from 'react';

class BigObject {
  constructor(public state: string) {}
  public readonly data = new Uint8Array(1024 * 1024 * 10);
}

// í´ë¡œì €ë¥¼ ì œê±°í•˜ê¸° ìœ„í•œ ì œë„¤ë¦­ binNull í•¨ìˆ˜
// DXë¥¼ í–¥ìƒí•˜ê¸° ìœ„í•œ íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ ì¶”ë¡ 
function bindNull<U extends unknown[]>(f: (args: U) => void, x: U): () => void {
  return f.bind(null, x);
}

export const App = () => {
  const [countA, setCountA] = useState(0);
  const [countB, setCountB] = useState(0);
  const bigData = new BigObject(`${countA}/${countB}`); // 10MB ë°ì´í„°

  const handleClickA = bindNull(
    ([count, setCount]) => {
      setCount(count + 1);
    },
    [countA, setCountA] as const
  );

  const handleClickB = bindNull(
    ([count, setCount]) => {
      setCount(count + 1);
    },
    [countB, setCountB] as const
  );

  const handleClickBoth = bindNull(
    ([countA, setCountA, countB, setCountB]) => {
      setCountA(countA + 1);
      setCountB(countB + 1);
      console.log(bigData.data.length);
    },
    [countA, setCountA, countB, setCountB] as const
  );

  return (
    <div>
      <button onClick={handleClickA}>Increment A</button>
      <button onClick={handleClickB}>Increment B</button>
      <button onClick={handleClickBoth}>Increment Both</button>
      <p>
        A: {countA}, B: {countB}
      </p>
    </div>
  );
};
```

ì´ ì½”ë“œëŠ” ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ê°€ ì—†ê³  ë¦¬ì•¡íŠ¸ ì»´íŒŒì¼ëŸ¬ì—ì„œ ì˜ˆìƒëŒ€ë¡œ ì‘ë™í•©ë‹ˆë‹¤. ì˜ë„í•˜ì§€ ì•Šì€ ë‹¤ë¥¸ ë¶€ìˆ˜ íš¨ê³¼ê°€ ì—†ì„ ê±°ë¼ê³  í™•ì‹ í•  ìˆ˜ëŠ” ì—†ì§€ë§Œ, ë¬¸ì œì— ëŒ€í•œ í¥ë¯¸ë¡œìš´ ì ‘ê·¼ ë°©ì‹ì´ë©° ìƒê°í•  ë§Œí•œ ê°€ì¹˜ê°€ ìˆìŠµë‹ˆë‹¤. (ë©´ì±… ì¡°í•­: ì €ëŠ” `bind`ì™€ ê·¸ ì˜ë¯¸ì— ëŒ€í•œ ì „ë¬¸ê°€ëŠ” ì•„ë‹™ë‹ˆë‹¤.)

## ê²°ë¡ 

ë¦¬ì•¡íŠ¸ ì»´íŒŒì¼ëŸ¬ëŠ” ì•„ë§ˆë„ 98%ì˜ ì½”ë“œë² ì´ìŠ¤ì˜ ì„±ëŠ¥ì„ í–¥ìƒí•˜ê³  ì½ê¸° ì‰½ê²Œ ë§Œë“¤ì–´ì¤„ í›Œë¥­í•œ ë„êµ¬ì…ë‹ˆë‹¤. ë‚˜ë¨¸ì§€ 2%ì˜ ê²½ìš°ì—ëŠ” ì¶©ë¶„í•˜ì§€ ì•Šì„ ìˆ˜ë„ ìˆê³  ì½”ë“œë¥¼ ì¶”ë¡ í•˜ê¸°ê°€ ë” ì–´ë ¤ì›Œì§ˆ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

í•œ ê°€ì§€ í™•ì‹¤í•œ ê²ƒì€ ì»´íŒŒì¼ëŸ¬ê°€ í´ë¡œì €ë¡œ ì¸í•œ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ë¡œë¶€í„° ì—¬ëŸ¬ë¶„ì„ êµ¬í•´ì£¼ì§€ ëª»í•œë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤. ì œ ìƒê°ì— ì´ê²ƒì€ ìë°”ìŠ¤í¬ë¦½íŠ¸ì™€ í•¨ìˆ˜í˜• í”„ë¡œê·¸ë˜ë° íŒ¨ëŸ¬ë‹¤ì„ì˜ ê·¼ë³¸ì ì¸ ë¬¸ì œì…ë‹ˆë‹¤. ìë°”ìŠ¤í¬ë¦½íŠ¸(ì ì–´ë„ V8)ì˜ í´ë¡œì €ëŠ” ì„¸ë¶„í™”ëœ ë©”ëª¨ë¦¬ ìµœì í™”ë¥¼ ìœ„í•´ ì„¤ê³„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì»´í¬ë„ŒíŠ¸ë¥¼ ë¹ ë¥´ê²Œ ë§ˆìš´íŠ¸/ì–¸ë§ˆìš´íŠ¸í•˜ê±°ë‚˜ ì ì€ ì–‘ì˜ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•˜ëŠ” ê²½ìš°ì—ëŠ” ê´œì°®ì§€ë§Œ, ë°ì´í„° ì¢…ì†ì„±ì´ í¬ê³  ìˆ˜ëª…ì´ ê¸´ ì»´í¬ë„ŒíŠ¸ê°€ ìˆëŠ” ê²½ìš°ì—ëŠ” ë¬¸ì œê°€ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì•ìœ¼ë¡œì˜ ì•„ì´ë””ì–´ëŠ” ìœ„ì˜ `bind` ì˜ˆì œì—ì„œì²˜ëŸ¼ í´ë¡œì €ì˜ ì¢…ì†ì„±ì„ ëª…ì‹œí•˜ëŠ” ë°©í–¥ìœ¼ë¡œ ë‚˜ì•„ê°ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì–´ì©Œë©´ ì´ ì‘ì—…ì„ í›¨ì”¬ ëœ ì¥í™©í•˜ê³  í¸ë¦¬í•˜ê²Œ ë§Œë“œëŠ” ë˜‘ë˜‘í•œ ë˜í¼ë¥¼ ë³¼ ìˆ˜ ìˆì„ì§€ë„ ëª¨ë¦…ë‹ˆë‹¤. í•˜ì§€ë§Œ ì§€ê¸ˆì€ ì´ ë¬¸ì œë¥¼ ì¸ì‹í•˜ê³  í•­ìƒ ê·¸ë ‡ë“¯ì´ ë‹¤ìŒê³¼ ê°™ì€ ëª¨ë²” ì‚¬ë¡€ë¥¼ ì—¼ë‘ì— ë‘ì–´ì•¼ í•©ë‹ˆë‹¤.

1. ì‘ì€ ì»´í¬ë„ŒíŠ¸ ì‘ì„±
2. ìˆœìˆ˜ ì»´í¬ë„ŒíŠ¸ ì‘ì„±
3. ì‚¬ìš©ì ì •ì˜ í•¨ìˆ˜/í›… ì‘ì„±
4. ë©”ëª¨ë¦¬ í”„ë¡œíŒŒì¼ëŸ¬ ì‚¬ìš©

ì´ ê¸€ì„ í†µí•´ ë¦¬ì•¡íŠ¸ ì»´íŒŒì¼ëŸ¬ì™€ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ë¥¼ ì²˜ë¦¬í•˜ëŠ” ë°©ë²•ì— ëŒ€í•œ í†µì°°ë ¥ì„ ì–»ìœ¼ì…¨ê¸°ë¥¼ ë°”ëë‹ˆë‹¤. ì§ˆë¬¸ì´ë‚˜ í”¼ë“œë°±ì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“ ì§€ X ë˜ëŠ” LinkedInìœ¼ë¡œ ì €ì—ê²Œ ì—°ë½í•˜ê±°ë‚˜ ì•„ë˜ì— ëŒ“ê¸€ì„ ë‚¨ê²¨ì£¼ì„¸ìš”. ì½ì–´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤! ğŸš€

> ğŸš€ í•œêµ­ì–´ë¡œ ëœ í”„ëŸ°íŠ¸ì—”ë“œ ì•„í‹°í´ì„ ë¹ ë¥´ê²Œ ë°›ì•„ë³´ê³  ì‹¶ë‹¤ë©´ [Korean FE Article](https://kofearticle.substack.com/)ì„ êµ¬ë…í•´ì£¼ì„¸ìš”!
