{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/react-compiler-closure-performance/","result":{"data":{"site":{"siteMetadata":{"title":"emewjin.log","siteUrl":"https://emewjin.github.io"}},"markdownRemark":{"id":"304e19c6-94cf-5da3-88fd-4dd010e44408","tableOfContents":"<ul>\n<li><a href=\"#%EC%9A%94%EC%95%BD-%ED%81%B4%EB%A1%9C%EC%A0%80-%EA%B7%B8%EB%A6%AC%EA%B3%A0-%EB%A9%94%EB%AA%A8%EB%A6%AC-%EB%88%84%EC%88%98\">요약: 클로저 그리고 메모리 누수</a></li>\n<li><a href=\"#%EB%A6%AC%EC%95%A1%ED%8A%B8-%EC%BB%B4%ED%8C%8C%EC%9D%BC%EB%9F%AC\">리액트 컴파일러</a></li>\n<li><a href=\"#%EB%88%84%EC%88%98%EA%B0%80-%EB%B0%9C%EC%83%9D%ED%95%98%EB%8A%94-%EC%BD%94%EB%93%9C\">누수가 발생하는 코드</a></li>\n<li><a href=\"#%EB%A6%AC%EC%95%A1%ED%8A%B8-%EC%BB%B4%ED%8C%8C%EC%9D%BC%EB%9F%AC-%EC%82%AC%EC%9A%A9-%ED%9B%84-%EB%9F%B0%ED%83%80%EC%9E%84-%EB%8F%99%EC%9E%91\">리액트 컴파일러 사용 후 런타임 동작</a></li>\n<li><a href=\"#%EC%BB%B4%ED%8C%8C%EC%9D%BC%EB%90%9C-%EC%BD%94%EB%93%9C-%EC%9E%90%EC%84%B8%ED%9E%88-%EB%B3%B4%EA%B8%B0\">컴파일된 코드 자세히 보기</a></li>\n<li><a href=\"#%EC%BD%94%EB%93%9C%EB%A5%BC-%EB%B3%80%EA%B2%BD%ED%95%98%EC%97%AC-%EB%88%84%EC%88%98%EB%A5%BC-%EB%8B%A4%EC%8B%9C-%EB%B0%9C%EC%83%9D%EC%8B%9C%EC%BC%9C-%EB%B3%B4%EA%B8%B0\">코드를 변경하여 누수를 다시 발생시켜 보기</a></li>\n<li><a href=\"#%EB%AA%A8%EB%93%A0-%EB%A9%94%EB%AA%A8%EC%9D%B4%EC%A0%9C%EC%9D%B4%EC%85%98%EC%9D%84-%EC%A0%9C%EA%B1%B0%ED%95%98%EB%A9%B4-%EC%96%B4%EB%96%A8%EA%B9%8C%EC%9A%94\">모든 메모이제이션을 제거하면 어떨까요?</a></li>\n<li><a href=\"#bindnull-x%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%9C-%EC%8B%A4%ED%97%98%EC%A0%81-%ED%95%B4%EA%B2%B0-%EB%B0%A9%EB%B2%95\"><code class=\"language-text\">bind(null, x)</code>를 사용한 실험적 해결 방법</a></li>\n<li><a href=\"#%EA%B2%B0%EB%A1%A0\">결론</a></li>\n</ul>","excerpt":"원문: Sneaky React Memory Leaks: How the React compiler won’t save you  몇 주 전에 저는 리액트에서 이나  같은 메모이제이션 훅을 사용할 때, 클로저가 어떻게 메모리 누수를 일으킬 수 있는 지에 대한 글을 썼습니다. 이 글은 TLDR…","html":"<blockquote>\n<p>원문: <a href=\"https://schiener.io/2024-07-07/react-closures-compiler\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Sneaky React Memory Leaks: How the React compiler won’t save you</a></p>\n</blockquote>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 700px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.42857142857143%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAADBklEQVQozy3S329TBQDF8fvmg2zd8McTODZub+/t7Xrb+6vturVYtrViRnFA7diPulKwpSx0E5VpLGwrTpiEsU3YFmXqA2I0MVUMvBiDoAs/FsUnjdEXp5PEJ/+Br7Hx4fN8knOOUN+RZ0s0w2OhPhra+nFEMzR053gieZRt/S/jK5wi9uoMvZPz5GbfZ3TpKqOLH1Faukrm3HukzizTXZ7DX5xka/E8wpPBA4QD7XjcXgK2SShgYxk6fs2LLDmRnSJuWUZVPahuFUPX8fk0TF1HkV10tIeJd3URDto4cxMIjUYKQzdIxndjaxa65sXwevAoLoKmgcspIokium7jEkXcYgtSyzYs3UfPrmeIhGzagzbBQADn4QpCnaeHvQMvUKx+z7G5K4yeXmDkrQXGZ5c5deU6R187yZHKLKMzi4zMLHHk7CWOz7zD6yufsfzdz5QurDB1+WNyhSLNw2WER9VnSR/MM3Fng6m7D5m5t8HYN+tc+vFvzn/7K/Nf3uL06u9Ubv/Gm3c3OHvvL6Ye/MOJ238wv/YnpZvrXFxbpzeVpjl7EsFh7MeyTPYkk/TsTpLc00fvviHSz/cxPDRAonMnuRfzFEZKHMpmKRbyvDI5TXpgiP2pFP2DGbLZLKahIxenERqDB3CKIk1NTTXbW7YTCceY/vQrJj9fpfTBdU5cW+PtW79wvHqfytc/UbjwYa1fRVEIhYJEo1FM00AbO4fQEB6sraUobtxuFackEQm3U3q3ypn7DynfeMD4Jzep3PiBcnWVyrU7jK18wc4dUXTdIBKNkkgksC0La3wOoSEyjOxy4ZLlGlmWkSQJS9MZHDhEoitOJBQg3tlJR9DG1Frxe9y0er2YpsnTsRjd8TiWZdFWvojg2HEQRRKRXc7/STWK8l+Igqqq2IEAwbYOPK2ttRspLgmvqqB53HgUGZ9HRVMVohOLCI8kXqLen8ShdFLvjFDXHGLTUxabtho4moM1m8Uwm90xGrVd1NnPUR9J83h3hi3JwzTtLeDqP4Y//waxhSr/AokLt7CIOj+uAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"1\"\n        title=\"1\"\n        src=\"/static/716a27c41c92d189d9ff252c7ebde6d1/8c557/1.png\"\n        srcset=\"/static/716a27c41c92d189d9ff252c7ebde6d1/4edbd/1.png 175w,\n/static/716a27c41c92d189d9ff252c7ebde6d1/13ae7/1.png 350w,\n/static/716a27c41c92d189d9ff252c7ebde6d1/8c557/1.png 700w,\n/static/716a27c41c92d189d9ff252c7ebde6d1/e35ec/1.png 861w\"\n        sizes=\"(max-width: 700px) 100vw, 700px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>몇 주 전에 저는 리액트에서 <code class=\"language-text\">useCallback</code>이나 <code class=\"language-text\">useEffect</code> 같은 메모이제이션 훅을 사용할 때, <a href=\"https://schiener.io/2024-03-03/react-closures\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">클로저가 어떻게 메모리 누수를 일으킬 수 있는 지에 대한 글</a>을 썼습니다. 이 글은 <a href=\"https://tldr.tech/webdev\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">TLDR WebDev</a>, <a href=\"https://bytes.dev/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://bytes.dev/</a>, <a href=\"https://thisweekinreact.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">This Week In React</a>와 같은 멋진 뉴스레터 및 X에서 주목을 받았습니다 (응원해 주셔서 감사합니다! 🙏).</p>\n<p>당연히 많은 사람들이 제가 보여드린 메모리 누수가 새로운 리액트 컴파일러에서 어떻게 처리될지 궁금해했습니다. 리액트 팀의 답변은 아래와 같았습니다.</p>\n<blockquote class=\"twitter-tweet\" data-dnt=\"true\" align=\"center\"><p lang=\"en\" dir=\"ltr\">the compiler will cache these values so they won&#39;t keep getting re-allocated and memory won&#39;t grow infinitely</p>&mdash; Sathya Gunasekaran (@_gsathya) <a href=\"https://twitter.com/_gsathya/status/1795766442786218435?ref_src=twsrc%5Etfw\">May 29, 2024</a></blockquote>\n<script async src=\"https://platform.twitter.com/widgets.js\" charset=\"utf-8\"></script>\n<p>그럴듯하게 들리죠? 하지만 언제나 그렇듯이, 그 내면에 함정이 있습니다. 이 주제에 대해 자세히 알아보고 이전 글로부터 리액트 컴파일러가 코드를 어떻게 처리하는지 살펴보겠습니다.</p>\n<p><strong>바쁜 분들을 위한 TLDR</strong>: 리액트 컴파일러는 다른 것에 의존하지 않는 값을 캐싱하므로 계속 재할당되지 않습니다. 이렇게 하면 클로저로 인한 메모리 누수를 방지할 수 있습니다. 그러나 다른 값에 의존하는 클로저로 인한 메모리 누수를 방지하지는 못합니다. 여전히 문제를 인지하고 그에 따라 코드를 작성해야 합니다.</p>\n<h2 id=\"요약-클로저-그리고-메모리-누수\" style=\"position:relative;\"><a href=\"#%EC%9A%94%EC%95%BD-%ED%81%B4%EB%A1%9C%EC%A0%80-%EA%B7%B8%EB%A6%AC%EA%B3%A0-%EB%A9%94%EB%AA%A8%EB%A6%AC-%EB%88%84%EC%88%98\" aria-label=\"요약 클로저 그리고 메모리 누수 permalink\" class=\"heading-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>요약: 클로저 그리고 메모리 누수</h2>\n<p>이전 글에서 클로저가 어떻게 리액트에서 메모리 누수로 이어질 수 있는지에 대해 설명했습니다. 요점은 다음과 같습니다.</p>\n<ol>\n<li>클로저는 <strong>외부 스코프</strong>에서 변수를 캡처합니다. 리액트 컴포넌트에서 이는 종종 상태, 프로퍼티 또는 메모이제이션된 값을 캡쳐하는 것을 의미합니다.</li>\n<li>컴포넌트의 모든 클로저는 캡처된 변수가 저장되는 <strong>동일한 딕셔너리 스타일 객체(컨텍스트 객체)를 공유합니다.</strong> (각 내부 클로저가 아닌, 컴포넌트당 하나의 객체)</li>\n<li>컨텍스트 객체는 컴포넌트 함수가 호출될 때 한 번 생성되며, <strong>마지막 클로저가 가비지 컬렉터에 의해 수거될 수 있을 때까지 유지됩니다.</strong></li>\n<li>사용하지 않는 것부터 모든 형제 클로저로부터 <strong>캡쳐된 각 변수가</strong> 이 객체에 추가됩니다.</li>\n<li>클로저 중 하나를 캐시/메모이제이션하면 다른 클로저가 더 이상 사용되지 않더라도 <strong>전체 컨텍스트 객체</strong>가 유지됩니다.</li>\n</ol>\n<p>이는 클로저 중 하나가 큰 배열과 같은 큰 객체를 참조하는 경우 특히 중요합니다. 아래 스크린샷에서 <code class=\"language-text\">handleClick</code>이 “Closure (App)” 스코프에 대해 액세스 권한을 가지고 있음을 명확하게 확인할 수 있습니다. 이 스코프에는 <code class=\"language-text\">logLength</code>에서만 사용되는 <code class=\"language-text\">bigData</code>도 포함됩니다.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 700px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 43.42857142857143%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB80lEQVQoz0XSTW/TQBSFYf8OSkXTNh6Px56xPfZ47DhOGjdNQtqotHxUCCHBmhUbVmzZ8KNfFGfB4tE5yyPdG2TKYnWNKRpM4TC2QRtLnuTYNCaKIkIhiCKBtZY4TtDqiqf1xejDdsJdN0EIiZSSIEssXi+wbklhOyrXULqKeubReYbRklQppqHA+4bNZses7UjT7L/EYHQ2CkySUJQdZbvAVRWtr5h3NaW16DSlyCQ2j9FpROMdw3DLarhjcTNws1pTWMdUxISRIhQxQeciZocDw8OGbTdh1Ux43lzy89uEl90ZS/eaJjtnbs9Y95rDXcNmkdC7a+bVBW1+RpO9GnX2nCBNUsqsoqo9tnSUtsCYhNYnfHmf8ON7yuen48qIza3j66eG/RCyH8SY98N0tF9d8/xWEmitKfKSqsrxvqZ2GWVxnK+4vJIUueKwlfz5FfP3t6VfzJnPW5wr0FqRaoU2ChnHPD6UBDrV5MYRRTFhGCJENIqlRCk5Xu/NRDKdCt7d5/h+Q1bdoFODVJpQJog4YXKt2G1LgkQpiqrF+iWV7+i6ObPZbNT3PVWzwGQ5l1dT7neOx8cdta/JTYRJBUYLMi1Ik4iX55ogywza5Eh5+rlInv7p2E956seFw8rz+ePAfluz6jXD0pwsDOtVwWHv+Qf82SKahiV24AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"형제 클로저에서 접근 가능한 큰 배열을 가진 공유된 클로저\"\n        title=\"형제 클로저에서 접근 가능한 큰 배열을 가진 공유된 클로저\"\n        src=\"/static/016e33788fbbeb955a1a8ddb2c2fdebe/8c557/closure-scope.png\"\n        srcset=\"/static/016e33788fbbeb955a1a8ddb2c2fdebe/4edbd/closure-scope.png 175w,\n/static/016e33788fbbeb955a1a8ddb2c2fdebe/13ae7/closure-scope.png 350w,\n/static/016e33788fbbeb955a1a8ddb2c2fdebe/8c557/closure-scope.png 700w,\n/static/016e33788fbbeb955a1a8ddb2c2fdebe/e996b/closure-scope.png 1050w,\n/static/016e33788fbbeb955a1a8ddb2c2fdebe/2cefc/closure-scope.png 1400w,\n/static/016e33788fbbeb955a1a8ddb2c2fdebe/91a65/closure-scope.png 2476w\"\n        sizes=\"(max-width: 700px) 100vw, 700px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\"><p>형제 클로저에서 접근 가능한 큰 배열을 가진 공유된 클로저</p></figcaption>\n  </figure></p>\n<p>또한 깊게 중첩된 <code class=\"language-text\">useCallback</code> 참조 체인과 같은 흥미로운 부수 효과가 발생할 수 있습니다. 아래에서 안타까운 방식으로 상태를 변경하면 메모이제이션된 함수의 긴 <code class=\"language-text\">useCallback</code> 체인이 어떻게 생성되는지 확인할 수 있습니다.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 700px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB3UlEQVQoz1WTS2sUURCF53fIZEyYx31Mv/ventvPGRkIiIuQjcGVrtyIICIIEhe6Npv8Av/pkVPhNmZRVPftWx/nVFUvlFJYb1KURY+q9GjbHiEEhDagKArkeQ5rLYwx4F0Gn51z8N5L5h3mLMuwsEbj5xeN45AiS1vkmUddOxwOB1RVJVDGfr9/BqzregaWZSmRpikWL5YKfx/2+HNvcLX26A4TvBvQdT2maZJCBgsilIq7rpsjqqXShdYKq0uLh3uDm9cG1gY0boB3vVzu+16UsohKtdaikICmaSTzfLZstMJ2ZxG8xuMvgySxyDOHIvPSU+dqFEUpl6mAtqJlQqJlfkuSBAtaSBOL5Urj3a3Gj88Gm22F0Izw9YA29BinUZQQQjWEc3Bt20pEB6Iw9sRajeVK4fsng9s3Cko7BD/CVb1MfhyHGcriYRietiGEuc/PgOzNbqewtxq/vxkUuUKaOpS5R5HXMvW4IlTJd0KoLrZDLBMUgcYoXF4pXL/S+PpRY71NZECuGuDqIKriRM/nM06n0zxlgmVtNpvNDHxSq3HxUuH9ncHbGw1tChz8iMZNCKGTVWLfjsejZMKpjKoFGA8IIzSCldL4cKelBZwqg3vIoEWuzP9Tjn/TP4/BXmzn6twgAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"handleClicks 입니다.\"\n        title=\"`handleClicks` 입니다.\"\n        src=\"/static/3ef559e2c873bf001443c7cfbe5df51b/8c557/call-chain-focused.png\"\n        srcset=\"/static/3ef559e2c873bf001443c7cfbe5df51b/4edbd/call-chain-focused.png 175w,\n/static/3ef559e2c873bf001443c7cfbe5df51b/13ae7/call-chain-focused.png 350w,\n/static/3ef559e2c873bf001443c7cfbe5df51b/8c557/call-chain-focused.png 700w,\n/static/3ef559e2c873bf001443c7cfbe5df51b/e996b/call-chain-focused.png 1050w,\n/static/3ef559e2c873bf001443c7cfbe5df51b/2cefc/call-chain-focused.png 1400w,\n/static/3ef559e2c873bf001443c7cfbe5df51b/76435/call-chain-focused.png 1742w\"\n        sizes=\"(max-width: 700px) 100vw, 700px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\"><p><code class=\"language-text\">handleClicks</code> 입니다.</p></figcaption>\n  </figure></p>\n<p>이것은 대체로 함수형 자바스크립트의 근본적인 ‘문제’이지 리액트의 문제는 아닙니다. 다만 리액트는 클로저와 메모이제이션을 많이 사용하기 때문에 이 문제가 발생할 가능성이 훨씬 더 높습니다. 설계되지 않은 언어에 함수형 프로그래밍 패러다임을 적용하는 것은 단점일 수도 있습니다. (하지만 이는 또 다른 주제입니다.)</p>\n<h2 id=\"리액트-컴파일러\" style=\"position:relative;\"><a href=\"#%EB%A6%AC%EC%95%A1%ED%8A%B8-%EC%BB%B4%ED%8C%8C%EC%9D%BC%EB%9F%AC\" aria-label=\"리액트 컴파일러 permalink\" class=\"heading-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>리액트 컴파일러</h2>\n<p>새로운 <a href=\"https://react.dev/learn/react-compiler\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">리액트 컴파일러</a>에 대해 들어보셨을 것입니다. 리액트 팀은 코드를 보다 최적화된 버전으로 바꿔줄 새로운 빌드 도구를 열심히 개발하고 있습니다. 아직 개발 중이지만 모든 메모이제이션을 컴파일러에 위임하는 것이 목표입니다. 이렇게 하면 더 이상 <code class=\"language-text\">useCallback</code>를 어디에 넣을지 고민할 필요가 없고 코드를 간결하고 가독성 있게 유지할 수 있습니다.</p>\n<p>X에서 클로저 누수에 대해 받았던 응답을 믿어보면, 컴파일러는 “무언가”를 캐싱하여 누수를 방지할 수 있다는 얘기일 겁니다. 하지만 정확히 무엇을 캐싱하는 것일까요? 그리고 어떻게 누수를 방지할 수 있을까요? 알아봅시다.</p>\n<h2 id=\"누수가-발생하는-코드\" style=\"position:relative;\"><a href=\"#%EB%88%84%EC%88%98%EA%B0%80-%EB%B0%9C%EC%83%9D%ED%95%98%EB%8A%94-%EC%BD%94%EB%93%9C\" aria-label=\"누수가 발생하는 코드 permalink\" class=\"heading-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>누수가 발생하는 코드</h2>\n<p>아래는 이전 글의 코드인데, ‘Increment A’와 ‘Increment B’ 버튼을 번갈아 클릭하면 가비지 컬렉션이 발생하지 않는 <code class=\"language-text\">BigObject</code>가 새로 할당되는 것을 확인할 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useState<span class=\"token punctuation\">,</span> useCallback <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">BigObject</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">public</span> <span class=\"token keyword\">readonly</span> data <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Uint8Array</span><span class=\"token punctuation\">(</span><span class=\"token number\">1024</span> <span class=\"token operator\">*</span> <span class=\"token number\">1024</span> <span class=\"token operator\">*</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">App</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>countA<span class=\"token punctuation\">,</span> setCountA<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>countB<span class=\"token punctuation\">,</span> setCountB<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> bigData <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BigObject</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 10MB 데이터</span>\n\n  <span class=\"token keyword\">const</span> handleClickA <span class=\"token operator\">=</span> <span class=\"token function\">useCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setCountA</span><span class=\"token punctuation\">(</span>countA <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>countA<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> handleClickB <span class=\"token operator\">=</span> <span class=\"token function\">useCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setCountB</span><span class=\"token punctuation\">(</span>countB <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>countB<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// 문제를 보여드리기 위해서만 존재합니다</span>\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">handleClickBoth</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">handleClickA</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">handleClickB</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>bigData<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>handleClickA<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Increment A</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>handleClickB<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Increment B</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>handleClickBoth<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Increment Both</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        A: </span><span class=\"token punctuation\">{</span>countA<span class=\"token punctuation\">}</span><span class=\"token plain-text\">, B: </span><span class=\"token punctuation\">{</span>countB<span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"리액트-컴파일러-사용-후-런타임-동작\" style=\"position:relative;\"><a href=\"#%EB%A6%AC%EC%95%A1%ED%8A%B8-%EC%BB%B4%ED%8C%8C%EC%9D%BC%EB%9F%AC-%EC%82%AC%EC%9A%A9-%ED%9B%84-%EB%9F%B0%ED%83%80%EC%9E%84-%EB%8F%99%EC%9E%91\" aria-label=\"리액트 컴파일러 사용 후 런타임 동작 permalink\" class=\"heading-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>리액트 컴파일러 사용 후 런타임 동작</h2>\n<p>이 코드를 리액트 컴파일러에서 실행하고 메모리 누수를 재현해 보면 메모리 사용량이 일정하게 유지되고 메모리 스냅샷에 <code class=\"language-text\">BigObject</code> 인스턴스가 하나만 할당되어 있는 것을 확인할 수 있습니다.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 700px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 63.42857142857142%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB00lEQVQ4y62SS4/aMBSF80sQJI7zIA4ktsmLmECCBiQ2s+sSzezaXWfVv15lfCq7ZARS1XYxi6Prc5X7+VzFjsjjn2VTvSulxqIsRinlyNJ0dAkZF573Z7nuhzxCRj8IxjCKxoSx0dnt9noYBuwPe5xOJ0gpQSkFYwxN01jVdf2gtt2i2SpUjbLfm17f91bO6+uL/v72huv1qo/Ho+ac6/l8ruM41lVV6TzPNee5burK+izLtFJKt6rTXJaaMabj5VIvjZJEO0IIA0EQBHo2m2GxWMDzPONtOikFaBAjSSWG44A0XWG5TGBmuBCoqhpCShwOPTZFAYdSqgkhcF1X+76P2xlhGGIYepR1h9NR4OtLg6fTBWVZYL1eQwhp1zWXKqVwuVzQdR0cz/O0SUQImapN+BtOkSY+fnwL8eV5haJs0e2UBZoLi83GAo1v2xZCCDgGZCB31QIp9eHTCLtthFJSpFmN8/kMLiQYS8HS1K666zqssxyH/rbyXbIHoEkYRSEICeF5FFJyZDkHDUIkLLVgo5xzsNXKwkz9K9CsFYbBrYb2OU1n89OMph71fev/CZwG4zj+8BM0iqKHavRfwPuhe+Cd9K2vPwto3/G08vtnJvwF8P2NYY09U7AAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"단 하나의 BigObject만 할당되고 메모리 사용량은 일정하게 유지됩니다.\"\n        title=\"단 하나의 `BigObject`만 할당되고 메모리 사용량은 일정하게 유지됩니다.\"\n        src=\"/static/882b38519596b846060d58981bd751c4/8c557/compiler-first-try.png\"\n        srcset=\"/static/882b38519596b846060d58981bd751c4/4edbd/compiler-first-try.png 175w,\n/static/882b38519596b846060d58981bd751c4/13ae7/compiler-first-try.png 350w,\n/static/882b38519596b846060d58981bd751c4/8c557/compiler-first-try.png 700w,\n/static/882b38519596b846060d58981bd751c4/e996b/compiler-first-try.png 1050w,\n/static/882b38519596b846060d58981bd751c4/2cefc/compiler-first-try.png 1400w,\n/static/882b38519596b846060d58981bd751c4/eadfb/compiler-first-try.png 2386w\"\n        sizes=\"(max-width: 700px) 100vw, 700px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\"><p>단 하나의 <code class=\"language-text\">BigObject</code>만 할당되고 메모리 사용량은 일정하게 유지됩니다.</p></figcaption>\n  </figure></p>\n<p>미래가 밝아 보이죠? 하지만 컴파일된 코드를 자세히 살펴보고 컴파일러가 무엇을 하고 있는지 살펴봅시다.</p>\n<h2 id=\"컴파일된-코드-자세히-보기\" style=\"position:relative;\"><a href=\"#%EC%BB%B4%ED%8C%8C%EC%9D%BC%EB%90%9C-%EC%BD%94%EB%93%9C-%EC%9E%90%EC%84%B8%ED%9E%88-%EB%B3%B4%EA%B8%B0\" aria-label=\"컴파일된 코드 자세히 보기 permalink\" class=\"heading-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>컴파일된 코드 자세히 보기</h2>\n<p>Vite 프로젝트에 리액트 컴파일러를 추가하고 코드를 실행해 보았습니다. 컴파일러 출력은 약간 장황하지만 관련 부분은 다음과 같습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">App</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> $ <span class=\"token operator\">=</span> compilerRuntimeExports<span class=\"token punctuation\">.</span><span class=\"token function\">c</span><span class=\"token punctuation\">(</span><span class=\"token number\">22</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>countA<span class=\"token punctuation\">,</span> setCountA<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> reactExports<span class=\"token punctuation\">.</span><span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>countB<span class=\"token punctuation\">,</span> setCountB<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> reactExports<span class=\"token punctuation\">.</span><span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> t0<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>$<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">===</span> Symbol<span class=\"token punctuation\">.</span><span class=\"token function\">for</span><span class=\"token punctuation\">(</span><span class=\"token string\">'react.memo_cache_sentinel'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    t0 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BigObject</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    $<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> t0<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    t0 <span class=\"token operator\">=</span> $<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">const</span> bigData <span class=\"token operator\">=</span> t0<span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>훌륭한 <a href=\"https://playground.react.dev/#N4Igzg9grgTgxgUxALhASwLYAcIwC4AEwBUYCAyngIZ4IA0JZAwlQDasBGVcA1gQL4EAZjAgYCAHRAwE3PFIDcEgHYq4rKmDAEAQmgDmAeQ4ArBHELAVBAligdWaOARlUAJhGWsAngTc0qAgBeAmUEAHcCAFU0ZTwADgBBGBgqbwAKAEYABgAmABYCACoCHILi0uyASiVlfhUVBAAPHHxhKGULNE8CRKwsdKqiawI4TzBCAG0xjrxEhjI8Jmg4xIBdYMYKalp06tqbMeUJgmmVvB0FhCXznQ2Q0m2aBD2akaOTjgMAEQDNsMieiMpnMeEGCgIAHpIZUALI6AgQIR+AINZSHcaEAAWVGUblYCCYjl4iU2jxY7C4vHSg2CAD5huibARFstZol0jNVgQANSlN5M-gMM7stYC96Ygg4vEEolOHgIh7MNicbg8GlDIIMqxMmys26c268-kHATCrkXMW1EbQggAFSxaG0nh8BGaTrw2jwED8CAwmNStAIeCxCFsogcfolx2xuPxhOJCogIc2tK1jOZUrjssTHIFmel8blvB04JGGOOEAJADpWBB9OkvvpftRq-5WwTlPoQ-mBNamTI8LB0elywQADxuNAANzpY5s444UDw3vRnmLPCCwELOfliX4dIAkp0ZBgEHFeuPIUuV5457rmYvl6vEcoN1udwn5ToD8e4Kfz0IHQrxvVd70zBdQJ6ddEw-bMvxLZMsV-E8-UA3QkJA5873nCcsHAiCbESZAiAtfcGB0EjgAtH9cKvfCxyvKdZxGAV+AUEB+CAA\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">리액트 컴파일러 플레이그라운드</a>에서 전체 출력을 확인하실 수도 있습니다.</p>\n<p>컴파일러는 메모이제이션된 값을 캐시하는 데 사용되는 새로운 변수 <code class=\"language-text\">$</code>를 추가했습니다. 또한 캐시된 값을 무효화하는 참조 검사를 <code class=\"language-text\">if()</code>에 인라인 처리했습니다. 이것이 바로 의존성 배열의 백그라운드에서 일어난 일입니다.</p>\n<p>이제 <code class=\"language-text\">BigObject</code>가 한 번만 생성되어 캐시에 저장됩니다. 이렇게 하면 컴포넌트를 렌더링할 때마다 <code class=\"language-text\">BigObject</code>가 더 이상 생성되지 않으므로 메모리 누수를 방지할 수 있습니다.</p>\n<p><code class=\"language-text\">BigObject</code>는 상태나 프로퍼티에 대한 종속성이 없으므로 컴파일러는 안전하게 캐싱할 수 있다고 가정합니다. 이는 원본 코드에서 <code class=\"language-text\">const bigData = useMemo(() => new BigObject(), [])</code>를 작성하는 것과 동일합니다.</p>\n<blockquote>\n<p>💡 이것은 리액트에서 <em>순수 컴포넌트</em> 를 작성하는 것이 중요한 이유를 보여줍니다. 각 렌더링은 동일한 프로퍼티와 상태가 주어졌을 때 동일한 출력을 생성해야 합니다. 제 예시에서는 렌더링할 때마다 새로운 <code class=\"language-text\">BigObject</code>를 생성하여 이 규칙을 위반했고, 이 새로운 인스턴스에 의존하여 메모리 누수를 보여주었습니다.</p>\n</blockquote>\n<p>이것이 Sathya가 X에서 응답한 내용입니다. 리액트 컴파일러는 <em>다른 어느 것에도 의존하지 않는 값</em> 을 캐싱하므로 계속 재할당되지 않습니다. 안타깝게도 이렇게 해도 문제는 해결되지 않고 제 예제가 더 이상 작동하지 않는다는 것을 보여줄 뿐입니다. 크롬 개발자 도구에서 가장 긴 거리를 가진 리테이너(retainer)를 보면 쉽게 확인할 수 있습니다.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 700px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 62.28571428571429%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAACB0lEQVQoz3WS23LTMBCG8yZMateST7Ktgy3ZcdwCNyUJN5AB2hsO7fu/ANXP7DZhmmG42NlY0X77769dGdP+HoYhTtMUvfdRax2ruo41hVKclVJRNSrWquEzdTqvTtG0beyHIYZxfF7d3z/Ex1+PyLIMfd9js9lgHEdM08T55uYG02aDEAK08zC2h7EW1jp47/m805p/U/3qeDw+Pz09gZSd1ZDS/X4fx3Hizs65aE9B/4UwctBU8zzH29u38XD4GJdliSshxHOapliv13EYBizLwirv7u6wbLfcWWsNYwwHfZNyukuKSCHV7HY7zPOMVZqmDEzTNBZFgaLIucj1Aapp0bQdirKEkDlHJiSuM8FRqwZuGPiOdY7zBTDLBLLsGnluYc2MEF480sZASAkpJfI8h1IKVVWxd6ppoLVB27Y8AQOTJGGgEAJCSDx8KuB7D2c3rJYuUsEZaK1lGygITLmua7bhAiilwPpK4sfXHN+/VMjzAcEH9oqARVGCbDl7SI3OQFJNm/GPwjyXeLMmoMC7pYOqJ4YS4KyEFBKs67q/QGr4XyCZX1cCP79JtE0HowO8D1xIEPLVOfd65EhAWqkLIC03QemlrxKB7Sjx+VCgqgb0bmLQeflJ5WuFXdfFi0dJkoTXhi5QJj+vEokP7wUmX0LVDtY4BtJoBCTfyrKkcWPDr63jH9TAe5E45/JaAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"여전히 다양한 콜백의 긴 참조 체인이 번갈아 가며 존재합니다.\"\n        title=\"여전히 다양한 콜백의 긴 참조 체인이 번갈아 가며 존재합니다.\"\n        src=\"/static/a5b1cf711dae4f02dd3161ba452b4062/8c557/call-chain.png\"\n        srcset=\"/static/a5b1cf711dae4f02dd3161ba452b4062/4edbd/call-chain.png 175w,\n/static/a5b1cf711dae4f02dd3161ba452b4062/13ae7/call-chain.png 350w,\n/static/a5b1cf711dae4f02dd3161ba452b4062/8c557/call-chain.png 700w,\n/static/a5b1cf711dae4f02dd3161ba452b4062/e996b/call-chain.png 1050w,\n/static/a5b1cf711dae4f02dd3161ba452b4062/2cefc/call-chain.png 1400w,\n/static/a5b1cf711dae4f02dd3161ba452b4062/42126/call-chain.png 2884w\"\n        sizes=\"(max-width: 700px) 100vw, 700px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\"><p>여전히 다양한 콜백의 긴 참조 체인이 번갈아 가며 존재합니다.</p></figcaption>\n  </figure></p>\n<h2 id=\"코드를-변경하여-누수를-다시-발생시켜-보기\" style=\"position:relative;\"><a href=\"#%EC%BD%94%EB%93%9C%EB%A5%BC-%EB%B3%80%EA%B2%BD%ED%95%98%EC%97%AC-%EB%88%84%EC%88%98%EB%A5%BC-%EB%8B%A4%EC%8B%9C-%EB%B0%9C%EC%83%9D%EC%8B%9C%EC%BC%9C-%EB%B3%B4%EA%B8%B0\" aria-label=\"코드를 변경하여 누수를 다시 발생시켜 보기 permalink\" class=\"heading-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>코드를 변경하여 누수를 다시 발생시켜 보기</h2>\n<p>이제 리액트 컴파일러가 어떻게 작동하는지 이해했으니 코드를 쉽게 변경하는 것으로 사랑스러운 메모리 누수를 다시 발생시킬 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useState<span class=\"token punctuation\">,</span> useCallback <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">BigObject</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">public</span> state<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">public</span> <span class=\"token keyword\">readonly</span> data <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Uint8Array</span><span class=\"token punctuation\">(</span><span class=\"token number\">1024</span> <span class=\"token operator\">*</span> <span class=\"token number\">1024</span> <span class=\"token operator\">*</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">App</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>countA<span class=\"token punctuation\">,</span> setCountA<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>countB<span class=\"token punctuation\">,</span> setCountB<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> bigData <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BigObject</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>countA<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>countB<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 10MB 데이터</span>\n\n  <span class=\"token comment\">// 나머지 코드는 동일합니다</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>이제 <code class=\"language-text\">countA</code>와 <code class=\"language-text\">countB</code> 상태를 <code class=\"language-text\">BigObject</code> 생성자에 전달하면 각 상태 변경에 대해 새 인스턴스가 생성됩니다. 덧붙여서, 이것은 우리가 경험했던 원래 프로덕션 문제와도(첫 번째 글의 발단이 된) 조금 더 가깝습니다.</p>\n<p>이제 컴파일된 결과를 확인하면 <code class=\"language-text\">countA</code> 및 <code class=\"language-text\">countB</code> 상태에 대한 종속성을 확인할 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">App</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> $ <span class=\"token operator\">=</span> compilerRuntimeExports<span class=\"token punctuation\">.</span><span class=\"token function\">c</span><span class=\"token punctuation\">(</span><span class=\"token number\">24</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>countA<span class=\"token punctuation\">,</span> setCountA<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> reactExports<span class=\"token punctuation\">.</span><span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>countB<span class=\"token punctuation\">,</span> setCountB<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> reactExports<span class=\"token punctuation\">.</span><span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> t0 <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>countA<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>countB<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> t1<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>$<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">!==</span> t0<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    t1 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BigObject</span><span class=\"token punctuation\">(</span>t0<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    $<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> t0<span class=\"token punctuation\">;</span>\n    $<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> t1<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    t1 <span class=\"token operator\">=</span> $<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">const</span> bigData <span class=\"token operator\">=</span> t1<span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>그리고 메모리 누수가 다시 발생했습니다. 이제 렌더링할 때마다 <code class=\"language-text\">BigObject</code>가 생성되며 가비지 컬렉터에 의해 수거되지 않습니다. 버튼을 클릭할 때마다 메모리 사용량이 증가합니다.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 700px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 62.28571428571429%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAACTklEQVQoz32SSXLbMBBFdRSVSXMESIITSBAcoHCQrMEDE9upJJssfP8DRPgpUUllE3vxqwEU8Lp/o1dpwn5xnmsppc7zXIdhqAmlVxFyFaXaJ0T7vq8JJcua0EBTSjUNqI5YpHlRaCHEefXy8qrf3t4wzzOapkFRFGjbFnUtIWWNUtTghUCneqjNgLZVkHUHXm3AiwqcCyRJjjwvkWUFVlJWZ6UULtnX67WO41inaapd19NpEuj5cdC94loUga6rSBc5WVSVge43XG/HSu9GqU8HtexXhmGc1+s1bm5utGEYyPMc0zSC5wU2fY7+23c0zz8QTkeE2yPk/Iry4Rlk2C9KjzPE4zO6rz8xveyxMk3zbJomTNNcgL7vIwgoHMeHFD5ELVHWG9AoRcorjLsj1LBDwDJ4lC3nCRco6x5tw/4BDcPQl2hZFmzbgnlrQ3Ab09BiHAYkMUMtK3yen3A6HpBnCRgLkWUJmrrCNG0xbv4AL5X9Bdq2DddxcHvrQHAHsiohRANKo6Xp2+0en/oRYRjD9QiCkCFNc5SiRVeH/wc6jrNU2AgHj6cWhzuFRsbYjhJf5h2eHgbUFUPJCVSbYhoEHk4j7u/Y+0DLssFCD/cHheNeLY+6JoUo6KIscaHabElyBfZQbfI+cLHueijK66wFQQTLcmAY1/4apoUkyVCW1cW+rqoahIb6Q6DnebjM6GXYCfHhug5c14XnucvnFQVH17VgjF3uacaijyxboJSi7RSCKAKhAXxC4RECEgSIWIwkzRAnKSLGdM6LJf4GyKmBuYCdmRYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"버튼을 클릭할 때마다 메모리 사용량이 증가합니다.\"\n        title=\"버튼을 클릭할 때마다 메모리 사용량이 증가합니다.\"\n        src=\"/static/f211d99239f0549741bf81d8ecced170/8c557/still-leaking.png\"\n        srcset=\"/static/f211d99239f0549741bf81d8ecced170/4edbd/still-leaking.png 175w,\n/static/f211d99239f0549741bf81d8ecced170/13ae7/still-leaking.png 350w,\n/static/f211d99239f0549741bf81d8ecced170/8c557/still-leaking.png 700w,\n/static/f211d99239f0549741bf81d8ecced170/e996b/still-leaking.png 1050w,\n/static/f211d99239f0549741bf81d8ecced170/2cefc/still-leaking.png 1400w,\n/static/f211d99239f0549741bf81d8ecced170/42126/still-leaking.png 2884w\"\n        sizes=\"(max-width: 700px) 100vw, 700px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\"><p>버튼을 클릭할 때마다 메모리 사용량이 증가합니다.</p></figcaption>\n  </figure></p>\n<h2 id=\"모든-메모이제이션을-제거하면-어떨까요\" style=\"position:relative;\"><a href=\"#%EB%AA%A8%EB%93%A0-%EB%A9%94%EB%AA%A8%EC%9D%B4%EC%A0%9C%EC%9D%B4%EC%85%98%EC%9D%84-%EC%A0%9C%EA%B1%B0%ED%95%98%EB%A9%B4-%EC%96%B4%EB%96%A8%EA%B9%8C%EC%9A%94\" aria-label=\"모든 메모이제이션을 제거하면 어떨까요 permalink\" class=\"heading-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>모든 메모이제이션을 제거하면 어떨까요?</h2>\n<p>프로덕션에서 이 문제에 직면했을 때, <code class=\"language-text\">handleClickBoth</code> 함수에서 볼 수 있는 이러한 상호 참조 클로저를 방지하기 위해 많은 메모이제이션을 제거했습니다. 이 함수는 다른 두 핸들러를 참조하기 때문에 메모이제이션된 값이 실제로는 효과가 없으며, 변경 사항을 추론하기가 훨씬 더 어려워집니다.</p>\n<p>이제 리액트 컴파일러를 사용하면 이 책임을 도구에 위임하기 때문에 더욱 주의해야 합니다. 아래 코드에는 메모이제이션이 전혀 없습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useState <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">BigObject</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">public</span> state<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">public</span> <span class=\"token keyword\">readonly</span> data <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Uint8Array</span><span class=\"token punctuation\">(</span><span class=\"token number\">1024</span> <span class=\"token operator\">*</span> <span class=\"token number\">1024</span> <span class=\"token operator\">*</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">App</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>countA<span class=\"token punctuation\">,</span> setCountA<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>countB<span class=\"token punctuation\">,</span> setCountB<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> bigData <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BigObject</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>countA<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>countB<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 10MB 데이터</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">handleClickA</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setCountA</span><span class=\"token punctuation\">(</span>countA <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">handleClickB</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setCountB</span><span class=\"token punctuation\">(</span>countB <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// 문제를 보여드리기 위해서만 존재합니다</span>\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">handleClickBoth</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">handleClickA</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">handleClickB</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>bigData<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>handleClickA<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Increment A</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>handleClickB<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Increment B</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>handleClickBoth<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Increment Both</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        A: </span><span class=\"token punctuation\">{</span>countA<span class=\"token punctuation\">}</span><span class=\"token plain-text\">, B: </span><span class=\"token punctuation\">{</span>countB<span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>하지만 메모리 누수는 컴파일러의 메모이제이션 마법에 의해 다시 추가됩니다. 컴파일러가 기본값이 된 후 리액트를 처음 사용하는 개발자라면 이 문제를 인식하고 디버깅하고 수정하기가 매우 어려울 수 있습니다.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 700px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 62.28571428571429%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAACW0lEQVQoz4WSSW/bMBCF/TeaBaijzRJJa7NEiZSo1XYcJ06CHNJjgQK59ND/D9TzCslA0VNzeHgzJPHhkcPFJo1/S5lTVVWU5zlxIYhxTkII4pxfJC5inP3Ti1liLShOYpJFQUqp8+L9/Rt9fHzg7e0NTdMgCAJ0XYdKa5jaQOsaslDQlcE47tA0PYzpUOoOeWFQFAqbTCKXJbK8wKKq9LnvOwjOyLKW5HkeFUVBnAsKAp/GQdPLaSRVhlRXCZXFeva+k9S3OQ19QeNQ0vPTMK8tLMs6f7n6iqvrO7q6sWDbK4zjgKbtIPMEp4cMr887dGaDPPXRtxlMlSDfBFCFQGtS7LcKp6ctXo4pFo5jn8fGxmGw6WG0oKQLxgQYY4jCAE21htIt8rwA5yG0NsgyiZXPEAQCXITz3nRmaMIL8Pu7jZ/fbfr1w8Zx62B558LzPLDAwdBG2O8PqOsKcRTN6atKg3OGMFwjTRIYU2O3u8f9mGBh2/b55tbC9a1N1zcWlksHvr+C663AuQejLwk3WT4nmoaTZQW8VfA3YZZLlKpBPyWcgI5jwXFsmtx1HaxWFyBjLh62EV5OW4y9RFOnOB6auc5SH6XkMDq+vOHjiJdjfAFa1jQMmyZ3nAtwkue5aM0Gr6cRh32FsS+gyzVkxlDmfO63Qznr9NihNcn/ga7rIo5TKF0jSTP4Podlu3AcD57nz1ef/mgUJTQNi4uQPgVKKdF1LaIohO/7CCYF/lwrpdA0BkkSYxgGmvxToFIasizBuJgVMA6+XiOKE6RZhiTdIIximgazDiP6A40pf0Xyv/+0AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"여전히 메모리 누수가 있지만 이제 컴파일러가 메모이제이션을 처리합니다.\"\n        title=\"여전히 메모리 누수가 있지만 이제 컴파일러가 메모이제이션을 처리합니다.\"\n        src=\"/static/1038a1fbb6f8403293c62ba74721831e/8c557/no-memoization.png\"\n        srcset=\"/static/1038a1fbb6f8403293c62ba74721831e/4edbd/no-memoization.png 175w,\n/static/1038a1fbb6f8403293c62ba74721831e/13ae7/no-memoization.png 350w,\n/static/1038a1fbb6f8403293c62ba74721831e/8c557/no-memoization.png 700w,\n/static/1038a1fbb6f8403293c62ba74721831e/e996b/no-memoization.png 1050w,\n/static/1038a1fbb6f8403293c62ba74721831e/2cefc/no-memoization.png 1400w,\n/static/1038a1fbb6f8403293c62ba74721831e/42126/no-memoization.png 2884w\"\n        sizes=\"(max-width: 700px) 100vw, 700px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\"><p>여전히 메모리 누수가 있지만 이제 컴파일러가 메모이제이션을 처리합니다.</p></figcaption>\n  </figure></p>\n<h2 id=\"bindnull-x를-사용한-실험적-해결-방법\" style=\"position:relative;\"><a href=\"#bindnull-x%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%9C-%EC%8B%A4%ED%97%98%EC%A0%81-%ED%95%B4%EA%B2%B0-%EB%B0%A9%EB%B2%95\" aria-label=\"bindnull x를 사용한 실험적 해결 방법 permalink\" class=\"heading-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><code class=\"language-text\">bind(null, x)</code>를 사용한 실험적 해결 방법</h2>\n<p>이전 글에 대한 일부 댓글에서 영감을 받아 이 문제에 대한 접근 방식 하나를 생각해냈습니다. 클로저를 완전히 우회하는 것입니다. 대신 <code class=\"language-text\">bind</code>를 사용하여 필수 값을 함수에 직접 전달해 볼 수 있습니다. <code class=\"language-text\">bind</code>를 사용하면 모든 클로저 간에 공유되는 컨텍스트 객체에 의존할 필요가 없습니다. 이 접근 방식은 좀 더 장황하지만 이러한 종류의 과도한 클로저를 방지하는 좋은 방법일 수 있습니다. DX도 타입스크립트 추론과 함께라면 그렇게 나쁘지 않습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useState <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">BigObject</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">public</span> state<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">public</span> <span class=\"token keyword\">readonly</span> data <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Uint8Array</span><span class=\"token punctuation\">(</span><span class=\"token number\">1024</span> <span class=\"token operator\">*</span> <span class=\"token number\">1024</span> <span class=\"token operator\">*</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// 클로저를 제거하기 위한 제네릭 binNull 함수</span>\n<span class=\"token comment\">// DX를 향상하기 위한 타입스크립트 추론</span>\n<span class=\"token keyword\">function</span> <span class=\"token generic-function\"><span class=\"token function\">bindNull</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token constant\">U</span> <span class=\"token keyword\">extends</span> <span class=\"token builtin\">unknown</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token function-variable function\">f</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>args<span class=\"token operator\">:</span> <span class=\"token constant\">U</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">void</span><span class=\"token punctuation\">,</span> x<span class=\"token operator\">:</span> <span class=\"token constant\">U</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">void</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token function\">f</span><span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">App</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>countA<span class=\"token punctuation\">,</span> setCountA<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>countB<span class=\"token punctuation\">,</span> setCountB<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> bigData <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BigObject</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>countA<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>countB<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 10MB 데이터</span>\n\n  <span class=\"token keyword\">const</span> handleClickA <span class=\"token operator\">=</span> <span class=\"token function\">bindNull</span><span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>count<span class=\"token punctuation\">,</span> setCount<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">setCount</span><span class=\"token punctuation\">(</span>count <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">[</span>countA<span class=\"token punctuation\">,</span> setCountA<span class=\"token punctuation\">]</span> <span class=\"token keyword\">as</span> <span class=\"token keyword\">const</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> handleClickB <span class=\"token operator\">=</span> <span class=\"token function\">bindNull</span><span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>count<span class=\"token punctuation\">,</span> setCount<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">setCount</span><span class=\"token punctuation\">(</span>count <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">[</span>countB<span class=\"token punctuation\">,</span> setCountB<span class=\"token punctuation\">]</span> <span class=\"token keyword\">as</span> <span class=\"token keyword\">const</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> handleClickBoth <span class=\"token operator\">=</span> <span class=\"token function\">bindNull</span><span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>countA<span class=\"token punctuation\">,</span> setCountA<span class=\"token punctuation\">,</span> countB<span class=\"token punctuation\">,</span> setCountB<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">setCountA</span><span class=\"token punctuation\">(</span>countA <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token function\">setCountB</span><span class=\"token punctuation\">(</span>countB <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>bigData<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">[</span>countA<span class=\"token punctuation\">,</span> setCountA<span class=\"token punctuation\">,</span> countB<span class=\"token punctuation\">,</span> setCountB<span class=\"token punctuation\">]</span> <span class=\"token keyword\">as</span> <span class=\"token keyword\">const</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>handleClickA<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Increment A</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>handleClickB<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Increment B</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>handleClickBoth<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Increment Both</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        A: </span><span class=\"token punctuation\">{</span>countA<span class=\"token punctuation\">}</span><span class=\"token plain-text\">, B: </span><span class=\"token punctuation\">{</span>countB<span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>이 코드는 메모리 누수가 없고 리액트 컴파일러에서 예상대로 작동합니다. 의도하지 않은 다른 부수 효과가 없을 거라고 확신할 수는 없지만, 문제에 대한 흥미로운 접근 방식이며 생각할 만한 가치가 있습니다. (면책 조항: 저는 <code class=\"language-text\">bind</code>와 그 의미에 대한 전문가는 아닙니다.)</p>\n<h2 id=\"결론\" style=\"position:relative;\"><a href=\"#%EA%B2%B0%EB%A1%A0\" aria-label=\"결론 permalink\" class=\"heading-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>결론</h2>\n<p>리액트 컴파일러는 아마도 98%의 코드베이스의 성능을 향상하고 읽기 쉽게 만들어줄 훌륭한 도구입니다. 나머지 2%의 경우에는 충분하지 않을 수도 있고 코드를 추론하기가 더 어려워질 수도 있습니다.</p>\n<p>한 가지 확실한 것은 컴파일러가 클로저로 인한 메모리 누수로부터 여러분을 구해주지 못한다는 것입니다. 제 생각에 이것은 자바스크립트와 함수형 프로그래밍 패러다임의 근본적인 문제입니다. 자바스크립트(적어도 V8)의 클로저는 세분화된 메모리 최적화를 위해 설계되지 않았습니다. 컴포넌트를 빠르게 마운트/언마운트하거나 적은 양의 데이터를 처리하는 경우에는 괜찮지만, 데이터 종속성이 크고 수명이 긴 컴포넌트가 있는 경우에는 문제가 될 수 있습니다.</p>\n<p>앞으로의 아이디어는 위의 <code class=\"language-text\">bind</code> 예제에서처럼 클로저의 종속성을 명시하는 방향으로 나아갈 수 있습니다. 어쩌면 이 작업을 훨씬 덜 장황하고 편리하게 만드는 똑똑한 래퍼를 볼 수 있을지도 모릅니다. 하지만 지금은 이 문제를 인식하고 항상 그렇듯이 다음과 같은 모범 사례를 염두에 두어야 합니다.</p>\n<ol>\n<li>작은 컴포넌트 작성</li>\n<li>순수 컴포넌트 작성</li>\n<li>사용자 정의 함수/훅 작성</li>\n<li>메모리 프로파일러 사용</li>\n</ol>\n<p>이 글을 통해 리액트 컴파일러와 메모리 누수를 처리하는 방법에 대한 통찰력을 얻으셨기를 바랍니다. 질문이나 피드백이 있으시면 언제든지 X 또는 LinkedIn으로 저에게 연락하거나 아래에 댓글을 남겨주세요. 읽어주셔서 감사합니다! 🚀</p>\n<blockquote>\n<p>🚀 한국어로 된 프런트엔드 아티클을 빠르게 받아보고 싶다면 <a href=\"https://kofearticle.substack.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Korean FE Article</a>을 구독해주세요!</p>\n</blockquote>","fields":{"slug":"/react-compiler-closure-performance/"},"frontmatter":{"title":"(번역) 교묘한 리액트 메모리 누수 - 리액트 컴파일러가 당신을 구하지 못하는 이유","date":"2024-07-22","lastUpdated":"2024-07-22","description":null,"tags":["React","번역"]}},"previous":{"fields":{"slug":"/understanding-react-compiler/"},"frontmatter":{"title":"(번역) 리액트 컴파일러 이해하기"}},"next":null},"pageContext":{"id":"304e19c6-94cf-5da3-88fd-4dd010e44408","previousPostId":"32ba0f22-54af-5862-88c2-02240230e55e","nextPostId":null,"ogImage":"public/og-image/react-compiler-closure-performance/index.png"}},"staticQueryHashes":["2260143708","984448874"]}